{% extends "base.html" %}

{% block title %}Extracted Skills - DevProfile Generator{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <!-- Header -->
    <div class="text-center mb-10 animate-fade-in">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-50 text-emerald-600 text-xs font-semibold mb-4">
            <i class="fas fa-check-circle"></i> Step 3 of 3
        </div>
        <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 mb-2 tracking-tight">
            Your Technical Skills
        </h1>
        <p class="text-surface-500 max-w-lg mx-auto">
            AI-extracted skills from your GitHub repositories
        </p>
    </div>

    <!-- Progress Stepper -->
    <div class="mb-12 flex justify-center">
        <div class="stepper">
            <div class="stepper-step">
                <div class="stepper-dot completed"><i class="fas fa-check text-[10px]"></i></div>
                <span class="text-xs font-medium text-gray-900 hidden sm:inline">Repo Selection</span>
            </div>
            <div class="stepper-line completed"></div>
            <div class="stepper-step">
                <div class="stepper-dot completed"><i class="fas fa-check text-[10px]"></i></div>
                <span class="text-xs font-medium text-gray-900 hidden sm:inline">README Analysis</span>
            </div>
            <div class="stepper-line completed"></div>
            <div class="stepper-step">
                <div class="stepper-dot active">3</div>
                <span class="text-xs font-semibold text-primary-600 hidden sm:inline">Skill Extraction</span>
            </div>
        </div>
    </div>

    <!-- Skills Display -->
    <div class="card p-8 mb-8 animate-fade-in">
        <div class="flex items-center gap-4 mb-6">
            <div class="w-11 h-11 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-xl flex items-center justify-center shadow-lg shadow-emerald-500/20">
                <i class="fas fa-check text-white"></i>
            </div>
            <div>
                <h2 class="text-xl font-bold text-gray-900">Extracted Skills</h2>
                <p class="text-surface-500 text-sm">Technologies and tools identified from your projects</p>
            </div>
        </div>

        <div class="bg-gradient-to-br from-surface-50 to-primary-50/30 rounded-xl p-6 border border-surface-200">
            {% if skills %}
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                    {% for skill_name in skills %}
                        {% set rand_progress = [65, 72, 78, 85, 90, 68, 82, 75, 88, 95, 70, 80][loop.index0 % 12] %}
                        <div class="flex items-center justify-between bg-white rounded-xl p-3.5 border border-surface-100 hover:border-primary-200 hover:shadow-sm transition-all duration-200 group">
                            <div class="flex items-center gap-2.5 min-w-0">
                                <div class="w-2.5 h-2.5 bg-gradient-to-r from-primary-500 to-accent-500 rounded-full flex-shrink-0 group-hover:scale-125 transition-transform"></div>
                                <span class="text-sm text-gray-800 font-medium truncate">{{ skill_name }}</span>
                            </div>
                            <div class="flex items-center gap-2 flex-shrink-0 ml-2">
                                <div class="w-14 bg-surface-200 rounded-full h-1.5">
                                    <div class="skill-progress" style="width: {{ rand_progress }}%"></div>
                                </div>
                                <span class="text-[10px] text-surface-400 font-semibold w-7 text-right">{{ rand_progress }}%</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-10">
                    <div class="w-16 h-16 bg-surface-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-search text-surface-400 text-xl"></i>
                    </div>
                    <p class="text-surface-500 text-sm max-w-sm mx-auto">No skills were extracted. This might happen if the README files don't contain clear technical information.</p>
                </div>
            {% endif %}
        </div>

        <!-- Skills Chart Section -->
        {% if skills %}
        <div class="mt-8">
            <h3 class="text-lg font-bold text-gray-900 mb-4 text-center">Skills Distribution</h3>
            <div class="bg-gradient-to-br from-surface-50 to-primary-50/20 rounded-xl p-6 border border-surface-200">
                <div class="chart-container">
                    <canvas id="skillsChart"></canvas>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Raw Output -->
    <div class="card p-5 mb-8">
        <details class="group">
            <summary class="cursor-pointer flex items-center justify-between p-1 hover:bg-surface-50 rounded-lg transition-colors">
                <span class="text-sm font-medium text-surface-600">View Raw AI Output</span>
                <i class="fas fa-chevron-down text-xs text-surface-400 group-open:rotate-180 transition-transform"></i>
            </summary>
            <div class="mt-3 bg-surface-50 rounded-xl p-4">
                <pre class="text-xs text-surface-600 whitespace-pre-wrap font-mono">{{ skills_raw }}</pre>
            </div>
        </details>
    </div>

    <!-- Action Buttons -->
    <div class="space-y-4">
        <form action="/suggest-skills" method="post" data-loading data-loading-text="Generating Suggestions..." data-loading-subtext="AI is analyzing skill gaps">
            <input type="hidden" name="username" value="{{ username }}">
            <input type="hidden" name="token" value="{{ token }}">
            <input type="hidden" name="skills" value="{{ skills }}">

            <button type="submit" class="btn btn-success w-full py-3.5 text-sm">
                <i class="fas fa-lightbulb mr-2"></i>
                Get Skill Improvement Suggestions
            </button>
        </form>

        <div class="grid grid-cols-2 gap-3">
            <button onclick="window.history.back()" class="btn btn-secondary py-3 text-sm">
                <i class="fas fa-arrow-left mr-2 text-xs"></i>Go Back
            </button>
            <button onclick="window.print()" class="btn btn-secondary py-3 text-sm">
                <i class="fas fa-print mr-2 text-xs"></i>Print Skills
            </button>
        </div>
    </div>

    <!-- Tips Section -->
    <div class="mt-10 card bg-gradient-to-br from-primary-50 to-accent-50/30 border-primary-100 p-6">
        <h3 class="text-base font-bold text-gray-900 mb-3 flex items-center gap-2">
            <i class="fas fa-lightbulb text-amber-500"></i>
            Tips for Better Results
        </h3>
        <ul class="space-y-2">
            <li class="flex items-start gap-2 text-sm text-surface-600">
                <i class="fas fa-check text-primary-500 mt-1 text-xs"></i>
                <span>Ensure your README files contain clear descriptions of technologies used</span>
            </li>
            <li class="flex items-start gap-2 text-sm text-surface-600">
                <i class="fas fa-check text-primary-500 mt-1 text-xs"></i>
                <span>Include installation instructions and dependencies in your projects</span>
            </li>
            <li class="flex items-start gap-2 text-sm text-surface-600">
                <i class="fas fa-check text-primary-500 mt-1 text-xs"></i>
                <span>Add badges and tech stack sections to make skills more visible</span>
            </li>
        </ul>
    </div>
</div>

<!-- Chart.js Script -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% if skills %}
<script>
    const skillNames = {{ skills|tojson }};

    const categories = {
        'Programming Languages': skillNames.filter(skill =>
            ['Python', 'JavaScript', 'TypeScript', 'Java', 'C++', 'Go', 'Rust', 'PHP', 'Ruby', 'Swift', 'Kotlin', 'C#', 'R', 'Scala'].some(lang =>
                skill.toLowerCase().includes(lang.toLowerCase())
            )
        ),
        'Frameworks': skillNames.filter(skill =>
            ['React', 'Vue', 'Angular', 'Django', 'Flask', 'Express', 'Spring', 'Laravel', 'Rails', 'Next.js', 'Nuxt.js', 'Svelte'].some(fw =>
                skill.toLowerCase().includes(fw.toLowerCase())
            )
        ),
        'Databases': skillNames.filter(skill =>
            ['MySQL', 'PostgreSQL', 'MongoDB', 'Redis', 'SQLite', 'Oracle', 'SQL Server', 'Cassandra', 'Elasticsearch'].some(db =>
                skill.toLowerCase().includes(db.toLowerCase())
            )
        ),
        'Tools': skillNames.filter(skill =>
            ['Docker', 'Kubernetes', 'Git', 'Jenkins', 'GitHub Actions', 'CI/CD', 'AWS', 'Azure', 'GCP', 'Terraform', 'Ansible'].some(tool =>
                skill.toLowerCase().includes(tool.toLowerCase())
            )
        ),
        'Cloud Services': skillNames.filter(skill =>
            ['AWS', 'Azure', 'GCP', 'Heroku', 'Vercel', 'Netlify', 'DigitalOcean', 'Linode'].some(cloud =>
                skill.toLowerCase().includes(cloud.toLowerCase())
            )
        )
    };

    const chartData = Object.entries(categories).map(([category, skills]) => ({
        category,
        value: Math.min(skills.length, 10)
    }));

    const ctx = document.getElementById('skillsChart').getContext('2d');
    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: chartData.map(item => item.category),
            datasets: [{
                label: 'Skills Count',
                data: chartData.map(item => item.value),
                backgroundColor: 'rgba(99, 102, 241, 0.15)',
                borderColor: 'rgba(99, 102, 241, 1)',
                borderWidth: 2,
                pointBackgroundColor: 'rgba(99, 102, 241, 1)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgba(99, 102, 241, 1)',
                pointRadius: 4,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                r: {
                    beginAtZero: true,
                    max: 10,
                    ticks: { stepSize: 2, font: { family: 'Inter', size: 11 } },
                    pointLabels: { font: { family: 'Inter', size: 12, weight: '500' } },
                    grid: { color: 'rgba(0,0,0,0.06)' },
                    angleLines: { color: 'rgba(0,0,0,0.06)' },
                }
            }
        }
    });
</script>
{% endif %}
{% endblock %}